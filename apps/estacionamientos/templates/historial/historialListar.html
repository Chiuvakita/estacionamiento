{% include "navbarAdmin.html" %}

{% block content %}
<h1>Historial de Movimientos</h1>

<p><strong>Total de reservas registradas:</strong> {{ total_reservas }}</p>

{% regroup historial by estacionamiento as historial_por_espacio %}

{% for grupo in historial_por_espacio %}
  <div class="card">
    <h2>Espacio #{{ grupo.grouper.id }} ({{ grupo.grouper.get_tipo_display }})</h2>
    <table>
      <tr>
        <th>Patente</th>
        <th>Inicio</th>
        <th>Término</th>
        <th>Reserva</th>
      </tr>
      {% for r in grupo.list %}
      <tr>
        <td>{{ r.patente }}</td>
        <td>{{ r.fecha_inicio|date:"Y-m-d H:i" }}</td>
        <td>
          {% if r.fecha_termino %}
            {{ r.fecha_termino|date:"Y-m-d H:i" }}
          {% else %}
            En uso
          {% endif %}
        </td>
        <td>{% if r.es_reserva %}Sí{% else %}No{% endif %}</td>
      </tr>
      {% empty %}
      <tr><td colspan="4">Sin movimientos registrados</td></tr>
      {% endfor %}
    </table>
  </div>
{% empty %}
  <p>No hay registros en el historial.</p>
{% endfor %}

{% endblock %}
